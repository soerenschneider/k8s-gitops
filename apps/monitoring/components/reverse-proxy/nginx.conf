    worker_processes 1;
    events {
      worker_connections 1024;
    }

    http {
      server {
        listen 8080;
        absolute_redirect off;
        port_in_redirect off;

        # security settings
        server_tokens off;
        client_body_buffer_size 1k;
        client_header_buffer_size 1k;
        client_max_body_size 1k;
        large_client_header_buffers 2 1k;

        location /alertmanager {
            rewrite ^(/alertmanager)$ $1/ permanent;
        }

        location /alertmanager/ {
            proxy_pass http://alertmanager;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_connect_timeout 1s;
            proxy_read_timeout 3s;
            rewrite ^/alertmanager/(.*)$ /$1 break;
        }

        location /blackbox-exporter {
            rewrite ^(/blackbox-exporter)$ $1/ permanent;
        }

        location /blackbox-exporter/ {
            proxy_pass http://blackbox-exporter;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_connect_timeout 1s;
            proxy_read_timeout 3s;
            rewrite ^/blackbox-exporter/(.*)$ /$1 break;
        }

        location /prometheus {
            rewrite ^(/prometheus)$ $1/ permanent;
        }

        location /prometheus/ {
            proxy_pass http://prometheus;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_connect_timeout 1s;
            proxy_read_timeout 3s;
            rewrite ^/prometheus/(.*)$ /$1 break;
        }

        location /karma {
            proxy_pass http://karma;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_connect_timeout 1s;
            proxy_read_timeout 3s;
            proxy_redirect off;
        }

        location /pushgateway {
            rewrite ^(/pushgateway)$ $1/ permanent;
        }

        location /pushgateway/ {
            proxy_pass http://pushgateway;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_connect_timeout 1s;
            proxy_read_timeout 3s;
            rewrite ^/pushgateway/(.*)$ /$1 break;
        }

        location /vmalert {
            rewrite ^(/vmalert)$ $1/ permanent;
        }

        location /vmalert/ {
            proxy_pass http://vmalert;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_connect_timeout 1s;
            proxy_read_timeout 3s;
            rewrite ^/vmalert/(.*)$ /$1 break;
        }

        location = /health {
          access_log off;
          add_header 'Content-Type' 'application/json';
          return 200 '{"status":"UP"}';
        }

        location / {
          return 404;
        }
      }
    }
