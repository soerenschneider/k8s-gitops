---
apiVersion: "kustomize.config.k8s.io/v1alpha1"
kind: "Component"
patches:
  - target:
      kind: "Deployment"
      name: "prometheus"
    patch: |-
      - op: add
        path: "/spec/template/spec/containers/0/args/-"
        value: "--config.file=/etc/config/prometheus.yaml"
      - op: add
        path: "/spec/template/spec/containers/0/volumeMounts/-"
        value:
          name: "prometheus-config"
          readOnly: true
          mountPath: "/etc/config/"
      - op: add
        path: "/spec/template/spec/volumes/-"
        value:
          name: "prometheus-config"
          secret:
            defaultMode: 420
            secretName: "monitoring-prometheus-config"
